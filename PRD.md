# Lightweight Web PDF Viewer — PRD & Implementation Plan

## Problem Recap
Current NLP pipelines output annotated PDFs (via Adobe highlights/comments/bookmarks). Limitations:
1. No streamlined feedback loop for improving NLP models.
2. Inefficient review workflow (network drives, manual PDF search).

## Goal
Deliver a **lightweight, web-based PDF viewer** that:
- Loads PDFs + annotations generated by NLP pipeline.
- Allows toggling, filtering, and reviewing annotations.
- Collects structured feedback (JSON/CSV/XFDF export, optional API sync).
- Works on Mac + Windows, scales to large PDFs.
- Deployable as standalone HTML app, desktop wrapper (Electron/Tauri), or on-prem web app.

---

## Core Requirements
### Functional
1. **PDF Rendering**
   - Use PDF.js for reliable cross-platform rendering.
   - Must handle 100+ page PDFs efficiently.

2. **Annotation Display & Toggling**
   - Load annotations (highlights/bookmarks/comments).
   - Provide **sidebar list of annotations** (click → jump).
   - Provide **keyboard shortcuts** (←/→) to toggle.
   - Provide **filters/toggles** (entity type, confidence, etc.).

3. **Feedback Capture**
   - Users can:
     - Mark annotation as **Correct/Incorrect/Needs Edit**.
     - Add free-text comment.
   - Use **icons/badges or sidecar panel** for marking feedback.
   - Avoid changing annotation highlight colors (pipeline colors reserved).

4. **Feedback Export & Collection**
   - Store locally in JSON schema.
   - Export to:
     - **JSON** (preferred for retraining).
     - **CSV** (easy customer use).
     - **XFDF** (optional, Adobe compatibility).
   - Support manual upload (drag/drop, SFTP, secure portal).
   - Optional: direct **API sync** to centralized server with auth.

5. **Performance & Usability**
   - Smooth scrolling & lazy loading.
   - Search within PDF & annotations.
   - Customer-friendly UI (no technical jargon).

### Non-Functional
- **Cross-platform** (Win/Mac via Electron/Tauri).
- **Simple distribution** (single executable or static files).
- **On-prem hosting** option for IT-savvy customers.
- **Scalable** to PDFs with thousands of annotations.

---

## Architecture Options
### Option A — Standalone Web App (HTML + JS)
- Deliver as static files, customer opens in browser.
- Pros: lightweight, zero-install.
- Cons: harder to save feedback locally without filesystem API.

### Option B — Desktop App (Electron or Tauri)
- Bundle PDF.js viewer in desktop wrapper.
- Pros: easy local file pick, local feedback storage, offline support.
- Cons: slightly heavier distribution.

### Option C — On-Prem Web Server (Dockerized)
- Host PDF viewer internally.
- Pros: IT-friendly, central control.
- Cons: requires customer IT support.

**Recommendation:** Start with **Option B (Desktop App)** for non-technical users, then add Option C for enterprise IT integration.

---

## Feedback Data Schema (JSON)
```json
{
  "file": "record123.pdf",
  "annotations": [
    {
      "id": "a1",
      "page": 5,
      "entity_type": "Diagnosis",
      "highlight": "Type 2 Diabetes",
      "status": "correct",
      "comment": "Matches policy wording"
    }
  ],
  "exported_at": "2025-09-29T12:00:00Z"
}
```

CSV export = flattened version of above. XFDF = optional Adobe-compatible export.

---

## Feedback Flow
1. Annotated PDF + JSON delivered to customer.
2. Customer reviews in PDF Viewer.
3. Feedback stored locally (IndexedDB / local JSON file).
4. Customer **exports JSON/CSV/XFDF**.
5. Customer uploads to secure SFTP/portal OR app syncs via API.

---

## Security & Compliance
- Local-first storage.
- HTTPS for API sync.
- No PHI leaves system unless exported intentionally.
- Configurable to match HIPAA requirements.

---

## Implementation Plan
### Phase 1 — MVP (4–6 weeks)
- Electron app with PDF.js rendering.
- Load annotations (JSON).
- Sidebar + toggling + filters.
- Feedback panel with status + comment.
- Local save/export (JSON, CSV).

### Phase 2 — Interoperability (4 weeks)
- XFDF export option.
- Improved performance for 500+ page PDFs.
- Search across annotations.

### Phase 3 — Feedback Sync (4–6 weeks)
- Secure API integration.
- Auth (JWT, SSO).
- Admin dashboard for aggregated feedback.

---

## Next Steps
1. Validate with customer champions: does sidebar + toggle + feedback export meet needs?
2. Decide MVP deployment path (Electron vs pure web).
3. Build MVP scaffold in Cursor.
4. Test with real annotated PDFs.
5. Plan rollout + support model.
